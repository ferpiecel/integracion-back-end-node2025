<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    />
    <title>Iniciar sesión</title>
  </head>
  <body class="bg-light">
    <div
      class="container min-vh-100 d-flex align-items-center justify-content-center py-5"
    >
      <div class="col-12 col-sm-10 col-md-8 col-lg-5">
        <div class="card shadow-sm border-0">
          <div class="card-body p-4 p-md-5">
            <h1 class="h3 text-center mb-4">Iniciar sesión</h1>

            <form onsubmit="event.preventDefault(); login();" novalidate>
              <div class="mb-3">
                <label for="email" class="form-label">Correo electrónico</label>
                <div class="input-group">
                  <span class="input-group-text" id="email-addon">@</span>
                  <input
                    type="email"
                    class="form-control"
                    placeholder="tu@correo.com"
                    aria-label="email"
                    aria-describedby="email-addon"
                    id="email"
                    autocomplete="email"
                    required
                  />
                </div>
              </div>

              <div class="mb-3">
                <label for="password" class="form-label">Contraseña</label>
                <div class="input-group">
                  <span class="input-group-text" id="password-addon">•••</span>
                  <input
                    type="password"
                    class="form-control"
                    placeholder="********"
                    aria-label="password"
                    aria-describedby="password-addon"
                    id="password"
                    autocomplete="current-password"
                    required
                  />
                </div>
              </div>

              <div class="d-grid gap-2">
                <button id="loginBtn" class="btn btn-success" type="submit">
                  <span
                    class="spinner-border spinner-border-sm me-2 d-none"
                    id="loginSpinner"
                    role="status"
                    aria-hidden="true"
                  ></span>
                  <span id="loginText">Ingresar</span>
                </button>
              </div>
            </form>

            <div
              id="output"
              class="alert alert-danger mt-3 d-none"
              role="alert"
            ></div>

            <p class="text-center text-muted small mt-4 mb-0">© 2025</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      let token = "";

      const outputEl = document.getElementById("output");
      const loginBtn = document.getElementById("loginBtn");
      const spinner = document.getElementById("loginSpinner");
      const loginText = document.getElementById("loginText");

      function setLoading(loading) {
        if (loading) {
          loginBtn.disabled = true;
          spinner.classList.remove("d-none");
          loginText.textContent = "Ingresando...";
        } else {
          loginBtn.disabled = false;
          spinner.classList.add("d-none");
          loginText.textContent = "Ingresar";
        }
      }

      async function login() {
        // limpiar mensajes previos
        outputEl.classList.add("d-none");
        outputEl.textContent = "";

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;

        if (!email || !password) {
          outputEl.textContent = "Ingresá tu correo y contraseña.";
          outputEl.classList.remove("d-none");
          return;
        }

        try {
          setLoading(true);
          const res = await fetch("http://localhost:3000/api/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          });

          if (res.ok) {
            const data = await res.json();
            token = data.token;
            const userId = data.userId;
            // Guardar token en localStorage
            localStorage.setItem("token", token);
            localStorage.setItem("userId", userId);
            // Redirigir a reservas
            window.location.href = "reserva.html";
          } else {
            const errorText = await res.text();
            outputEl.textContent = errorText || "Error al iniciar sesión.";
            outputEl.classList.remove("d-none");
          }
        } catch (err) {
          outputEl.textContent = "Error de red. Verificá tu conexión.";
          outputEl.classList.remove("d-none");
        } finally {
          setLoading(false);
        }
      }
    </script>
    <!-- Opcional: JS de Bootstrap si luego agregás componentes interactivos -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
